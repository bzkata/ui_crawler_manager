# 数据字段映射文档

本文档详细说明各平台数据字段到统一格式的映射关系。

## 目录

- [内容数据字段映射](#内容数据字段映射)
- [评论数据字段映射](#评论数据字段映射)
- [字段说明](#字段说明)

---

## 内容数据字段映射

### 统一字段格式

| 统一字段 | 类型 | 说明 |
|---------|------|------|
| `id` | string | 内容ID |
| `title` | string | 标题 |
| `content` | string | 内容/描述 |
| `create_time` | number | 创建时间（毫秒时间戳） |
| `user_id` | string | 用户ID |
| `nickname` | string | 昵称 |
| `avatar` | string | 头像URL |
| `liked_count` | number | 点赞数 |
| `comment_count` | number | 评论数 |
| `share_count` | number | 分享数 |
| `url` | string | 内容链接 |
| `ip_location` | string | IP位置 |
| `source_keyword` | string | 来源关键词 |
| `platform` | string | 平台标识（xhs/weibo/douyin/bili/kuaishou） |

### 各平台字段映射表

#### 小红书 (xhs)

| 统一字段 | 小红书字段 | 说明 | 示例值 |
|---------|-----------|------|--------|
| `id` | `note_id` | 笔记ID | "673aaa78000000001b012fdc" |
| `title` | `title` | 标题 | "买6盒布鲁可奥特曼闪耀9弹..." |
| `content` | `desc` | 描述内容 | "买6盒布鲁可奥特曼..." |
| `create_time` | `time` | 创建时间（毫秒） | 1731897976000 |
| `user_id` | `user_id` | 用户ID | "620deda30000000021021832" |
| `nickname` | `nickname` | 昵称 | "爱玩具的大成" |
| `avatar` | `avatar` | 头像URL | "https://sns-avatar-qc.xhscdn.com/..." |
| `liked_count` | `liked_count` | 点赞数（支持"1万"格式） | "1万" → 10000 |
| `comment_count` | `comment_count` | 评论数 | "165" → 165 |
| `share_count` | `share_count` | 分享数 | "178" → 178 |
| `url` | `note_url` | 笔记链接 | "https://www.xiaohongshu.com/..." |
| `ip_location` | `ip_location` | IP位置 | "" |
| `source_keyword` | `source_keyword` | 来源关键词 | "布鲁可" |

**小红书特有字段：**
- `type`: 内容类型（video/normal）
- `tag_list`: 标签列表
- `collected_count`: 收藏数
- `image_list`: 图片列表
- `video_url`: 视频URL

---

#### 微博 (weibo)

| 统一字段 | 微博字段 | 说明 | 示例值 |
|---------|---------|------|--------|
| `id` | `note_id` | 微博ID | "5250956833850206" |
| `title` | - | 标题（微博无标题字段，使用content） | - |
| `content` | `content` | 微博内容 | "帮布鲁可做了些分类建议..." |
| `create_time` | `create_time` | 创建时间（秒，自动转换为毫秒） | 1767437929 → 1767437929000 |
| `user_id` | `user_id` | 用户ID | "2631680860" |
| `nickname` | `nickname` | 昵称 | "剪短重新留长发男" |
| `avatar` | `avatar` | 头像URL | "https://tvax3.sinaimg.cn/..." |
| `liked_count` | `liked_count` | 点赞数 | "215" → 215 |
| `comment_count` | `comments_count` | 评论数 | "21" → 21 |
| `share_count` | `shared_count` | 分享数 | "28" → 28 |
| `url` | `note_url` | 微博链接 | "https://m.weibo.cn/detail/..." |
| `ip_location` | `ip_location` | IP位置 | "日本" |
| `source_keyword` | `source_keyword` | 来源关键词 | "布鲁可" |

**微博特有字段：**
- `gender`: 性别（m/f）
- `profile_url`: 用户主页URL
- `create_date_time`: 创建时间（格式化字符串）

---

#### 抖音 (douyin)

| 统一字段 | 抖音字段 | 说明 | 示例值 |
|---------|---------|------|--------|
| `id` | `aweme_id` | 视频ID | "7594432167866813705" |
| `title` | `title` | 标题 | "布鲁可又出新品啦！星球大战..." |
| `content` | `desc` | 描述内容 | "布鲁可又出新品啦！..." |
| `create_time` | `create_time` | 创建时间（秒，自动转换为毫秒） | 1768230900 → 1768230900000 |
| `user_id` | `user_id` | 用户ID | "3061489362543936" |
| `nickname` | `nickname` | 昵称 | "布鲁可官方旗舰店" |
| `avatar` | `avatar` | 头像URL | "https://p3-pc.douyinpic.com/..." |
| `liked_count` | `liked_count` | 点赞数 | "0" → 0 |
| `comment_count` | `comment_count` | 评论数 | "0" → 0 |
| `share_count` | `share_count` | 分享数 | "0" → 0 |
| `url` | `aweme_url` | 视频链接 | "https://www.douyin.com/video/..." |
| `ip_location` | `ip_location` | IP位置 | "" |
| `source_keyword` | `source_keyword` | 来源关键词 | "布鲁可" |

**抖音特有字段：**
- `aweme_type`: 视频类型
- `sec_uid`: 用户sec_uid
- `collected_count`: 收藏数
- `cover_url`: 封面图URL
- `video_download_url`: 视频下载URL
- `music_download_url`: 音乐下载URL

---

#### 哔哩哔哩 (bili)

| 统一字段 | 哔哩哔哩字段 | 说明 | 示例值 |
|---------|-------------|------|--------|
| `id` | `video_id` | 视频ID | "44093671" |
| `title` | `title` | 标题 | "百变布鲁可第一季 全集[1-20]" |
| `content` | `desc` | 描述内容 | "转载自 iqiyi.com..." |
| `create_time` | `create_time` | 创建时间（秒，自动转换为毫秒） | 1550580365 → 1550580365000 |
| `user_id` | `user_id` | 用户ID | "40065341" |
| `nickname` | `nickname` | 昵称 | "杏仁茸" |
| `avatar` | `avatar` | 头像URL | "https://i2.hdslb.com/bfs/face/..." |
| `liked_count` | `liked_count` | 点赞数 | "909" → 909 |
| `comment_count` | `video_comment` | 评论数 | "113" → 113 |
| `share_count` | `video_share_count` | 分享数 | "303" → 303 |
| `url` | `video_url` | 视频链接 | "https://www.bilibili.com/video/..." |
| `ip_location` | - | IP位置（哔哩哔哩无此字段） | - |
| `source_keyword` | `source_keyword` | 来源关键词 | "布鲁可" |

**哔哩哔哩特有字段：**
- `video_type`: 视频类型
- `video_play_count`: 播放数
- `video_favorite_count`: 收藏数
- `video_coin_count`: 投币数
- `video_danmaku`: 弹幕数
- `disliked_count`: 踩数
- `video_cover_url`: 封面图URL

---

#### 快手 (kuaishou)

| 统一字段 | 快手字段 | 说明 | 示例值 |
|---------|---------|------|--------|
| `id` | `video_id` | 视频ID | "3x98vyzxif5p25i" |
| `title` | `title` | 标题 | "假面骑士大改造！黑金歌查德！" |
| `content` | `desc` | 描述内容 | "假面骑士大改造！..." |
| `create_time` | `create_time` | 创建时间（毫秒） | 1754136000000 |
| `user_id` | `user_id` | 用户ID | "3x5dded5xmgd8dg" |
| `nickname` | `nickname` | 昵称 | "布鲁可创作者BFC" |
| `avatar` | `avatar` | 头像URL | "https://p2-pro.a.yximgs.com/..." |
| `liked_count` | `liked_count` | 点赞数 | "1016" → 1016 |
| `comment_count` | - | 评论数（快手无此字段，默认0） | 0 |
| `share_count` | - | 分享数（快手无此字段，默认0） | 0 |
| `url` | `video_url` | 视频链接 | "https://www.kuaishou.com/..." |
| `ip_location` | - | IP位置（快手无此字段） | - |
| `source_keyword` | `source_keyword` | 来源关键词 | "布鲁可" |

**快手特有字段：**
- `video_type`: 视频类型
- `viewd_count`: 观看数
- `video_cover_url`: 封面图URL
- `video_play_url`: 视频播放URL

---

## 评论数据字段映射

### 统一字段格式

| 统一字段 | 类型 | 说明 |
|---------|------|------|
| `comment_id` | string | 评论ID |
| `create_time` | number | 创建时间（毫秒时间戳） |
| `content_id` | string | 关联内容ID |
| `content` | string | 评论内容 |
| `user_id` | string | 用户ID |
| `nickname` | string | 昵称 |
| `avatar` | string | 头像URL |
| `like_count` | number | 点赞数 |
| `parent_comment_id` | string\|number | 父评论ID |
| `sub_comment_count` | number | 子评论数 |
| `ip_location` | string | IP位置 |
| `platform` | string | 平台标识 |

### 各平台字段映射表

#### 小红书评论 (xhs)

| 统一字段 | 小红书字段 | 说明 | 示例值 |
|---------|-----------|------|--------|
| `comment_id` | `comment_id` | 评论ID | "673b3ad0000000001a024197" |
| `create_time` | `create_time` | 创建时间（毫秒） | 1731934928000 |
| `content_id` | `note_id` | 关联笔记ID | "673aaa78000000001b012fdc" |
| `content` | `content` | 评论内容 | "可以把这个奥特曼卡片扫码" |
| `user_id` | `user_id` | 用户ID | "5a6da1dd4eacab3784688d82" |
| `nickname` | `nickname` | 昵称 | "侯玲" |
| `avatar` | `avatar` | 头像URL | "https://sns-avatar-qc.xhscdn.com/..." |
| `like_count` | `like_count` | 点赞数 | "10" → 10 |
| `parent_comment_id` | `parent_comment_id` | 父评论ID | 0 |
| `sub_comment_count` | `sub_comment_count` | 子评论数 | "4" → 4 |
| `ip_location` | `ip_location` | IP位置 | null → "" |

**小红书评论特有字段：**
- `pictures`: 评论图片

---

#### 微博评论 (weibo)

| 统一字段 | 微博字段 | 说明 | 示例值 |
|---------|---------|------|--------|
| `comment_id` | `comment_id` | 评论ID | "5250998289565565" |
| `create_time` | `create_time` | 创建时间（秒，自动转换为毫秒） | 1767447814 → 1767447814000 |
| `content_id` | `note_id` | 关联微博ID | "5250956833850206" |
| `content` | `content` | 评论内容 | "不够显眼了" |
| `user_id` | `user_id` | 用户ID | "7279461250" |
| `nickname` | `nickname` | 昵称 | "Bai_Prince川" |
| `avatar` | `avatar` | 头像URL | "https://tvax1.sinaimg.cn/..." |
| `like_count` | `comment_like_count` | 点赞数 | "5" → 5 |
| `parent_comment_id` | `parent_comment_id` | 父评论ID | "5250998289565565" |
| `sub_comment_count` | `sub_comment_count` | 子评论数 | "0" → 0 |
| `ip_location` | `ip_location` | IP位置 | "浙江" |

**微博评论特有字段：**
- `gender`: 性别（m/f）
- `profile_url`: 用户主页URL
- `create_date_time`: 创建时间（格式化字符串）

---

#### 抖音评论 (douyin)

| 统一字段 | 抖音字段 | 说明 | 示例值 |
|---------|---------|------|--------|
| `comment_id` | `comment_id` | 评论ID | "7594414144318407434" |
| `create_time` | `create_time` | 创建时间（秒，自动转换为毫秒） | 1768212335 → 1768212335000 |
| `content_id` | `aweme_id` | 关联视频ID | "7594132220185546047" |
| `content` | `content` | 评论内容 | "666我就知道不会轻易让我们玩清水[咒骂]" |
| `user_id` | `user_id` | 用户ID | "3408963356077424" |
| `nickname` | `nickname` | 昵称 | "鬼影" |
| `avatar` | `avatar` | 头像URL | "https://p3-pc.douyinpic.com/..." |
| `like_count` | `like_count` | 点赞数 | 5 |
| `parent_comment_id` | `parent_comment_id` | 父评论ID | "0" |
| `sub_comment_count` | `sub_comment_count` | 子评论数 | "3" → 3 |
| `ip_location` | `ip_location` | IP位置 | "广东" |

**抖音评论特有字段：**
- `sec_uid`: 用户sec_uid
- `short_user_id`: 短用户ID
- `user_unique_id`: 用户唯一ID
- `user_signature`: 用户签名
- `pictures`: 评论图片

---

#### 哔哩哔哩评论 (bili)

| 统一字段 | 哔哩哔哩字段 | 说明 | 示例值 |
|---------|-------------|------|--------|
| `comment_id` | `comment_id` | 评论ID | "102441810512" |
| `create_time` | `create_time` | 创建时间（秒，自动转换为毫秒） | 1644889621 → 1644889621000 |
| `content_id` | `video_id` | 关联视频ID | "44093671" |
| `content` | `content` | 评论内容 | "那可真好" |
| `user_id` | `user_id` | 用户ID | "1132445202" |
| `nickname` | `nickname` | 昵称 | "蛋仔派对开始看看你的" |
| `avatar` | `avatar` | 头像URL | "https://i0.hdslb.com/bfs/face/..." |
| `like_count` | `like_count` | 点赞数 | 1 |
| `parent_comment_id` | `parent_comment_id` | 父评论ID | "1402304495" |
| `sub_comment_count` | `sub_comment_count` | 子评论数 | "0" → 0 |
| `ip_location` | - | IP位置（哔哩哔哩无此字段） | - |

**哔哩哔哩评论特有字段：**
- `sex`: 性别
- `sign`: 用户签名

---

## 字段说明

### 数据类型转换规则

1. **时间戳转换**
   - 如果时间戳小于10位数字（秒级），自动乘以1000转换为毫秒
   - 如果时间戳大于等于10位数字（毫秒级），保持不变

2. **数字格式化**
   - 支持中文数字格式："1万" → 10000，"1千" → 1000
   - 字符串数字自动转换为数字类型
   - 无法转换时默认为0

3. **字段优先级**
   - 内容数据：`title` 优先使用 `title`，否则使用 `desc` 或 `content`
   - 评论数据：`comment_count` 在不同平台字段名不同，按优先级映射

4. **缺失字段处理**
   - 如果某个平台没有对应字段，统一字段设置为空字符串或0
   - 原平台的特有字段会保留在转换后的数据中

### 平台识别规则

系统会根据以下特征自动识别平台：

1. **抖音 (douyin)**: 存在 `aweme_id` 字段
2. **哔哩哔哩 (bili)**: 存在 `video_id` 且存在 `video_comment` 或 `video_danmaku` 字段
3. **快手 (kuaishou)**: 存在 `video_id` 且存在 `video_play_url` 字段
4. **微博 (weibo)**: 存在 `note_id` 且存在 `gender` 或 `create_date_time` 字段
5. **小红书 (xhs)**: 存在 `note_id` 且存在 `type` 或 `tag_list` 字段

### 数据类型识别规则

- **评论数据**: 存在 `comment_id` 字段
- **内容数据**: 存在 `note_id`、`aweme_id` 或 `video_id` 字段且不存在 `comment_id` 字段

---

## 转换示例

### 转换前（小红书内容）
```json
{
  "note_id": "673aaa78000000001b012fdc",
  "title": "买6盒布鲁可奥特曼闪耀9弹",
  "desc": "买6盒布鲁可奥特曼闪耀9弹，艾克斯哥莫拉装甲...",
  "time": 1731897976000,
  "liked_count": "1万",
  "comment_count": "165"
}
```

### 转换后（统一格式）
```json
{
  "id": "673aaa78000000001b012fdc",
  "title": "买6盒布鲁可奥特曼闪耀9弹",
  "content": "买6盒布鲁可奥特曼闪耀9弹，艾克斯哥莫拉装甲...",
  "create_time": 1731897976000,
  "liked_count": 10000,
  "comment_count": 165,
  "platform": "xhs",
  "note_id": "673aaa78000000001b012fdc",
  "time": 1731897976000
}
```

注意：原字段会保留在转换后的数据中，以便需要时访问。
